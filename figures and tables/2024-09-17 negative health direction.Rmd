---
title: "N IDPs in negative health direction"
---


```{r}
library(dplyr) # Run install.packages("tidyverse") to get this
library(tidyr) # Run install.packages("tidyr") to get this
library(ggplot2)
library("reshape") # Run install.packages("reshape") to get this
library("broom")
library(kableExtra) # Run install.packages("kableExtra")
library(openxlsx)

```

Set the date prior steps of the pipeline were run
```{r}

run_date <- "2024-07-29"

```


Set the filepath to get input files
```{r}
# Home computer
input_path <- "C:/Users/tvera/Box/UK Biobank/Data Sets/"

# Work computer
#input_path <- "C:/Users/vthornton/Box/UK Biobank/Data Sets/"

```

Set the filepath to save outputs to
```{r}
# Home computer
output_path <- "C:/Users/tvera/Box/UK Biobank/Alcohol x smoking/"

# Work computer
#output_path <- "C:/Users/vthornton/Box/UK Biobank/Alcohol x smoking/"

```


```{r}

# Load the results
load(paste0(output_path, "regression_scaled_", run_date, ".RData"))

```

Set p value to reference through the script
```{r}

p_value <- 0.01

```



Is a decrease bad?
```{r}

all_IDP_results <- all_IDP_results %>%
  mutate(decrease_bad = case_when(
    region == "ventricles" ~ 0,
    MRI == "T1" ~ 1,
    MRI == "T2" ~ 1,
    dMRI %in% c("FA", "ICVF") ~ 1,
    dMRI %in% c("MD", "ISOVF") ~ 0))

```



```{r}


total_volume_IDPs <- c("X26514.2.0", "X26518.2.0", "total_wm", "X26527.2.0")

all_IDP_results %>%
  mutate(map = ifelse(IDP %in% total_volume_IDPs, "total volume", map)) %>%
  group_by(MRI, map, dMRI, decrease_bad) %>%
  tally()

```

IDPs correctly sorted by decrease bad


It isn't clear how to interpret rfMRI, so drop the 6 ICs
```{r}

all_IDP_results <- all_IDP_results %>%
  filter(MRI != "rfMRI")

```


Alcohol
Filter for IDPs with a significant association with alcohol
```{r}

sig_alcohol <- all_IDP_results %>%
  filter(scaled_week_drinks_p < p_value)

```


```{r}

sig_alcohol %>%
  mutate(direction = ifelse(scaled_week_drinks_beta < 0, "neg", "pos")) %>%
  group_by(decrease_bad, direction) %>%
  tally()

```
Out of 230 IDPs significantly associated with alcohol at the 1% level, 221 (96%) are in the direction of reduced brain health. Only 9 are in a direction which is consistent with improved health.

Smoking
Filter for IDPs with a significant association with smoking
```{r}

sig_smoking <- all_IDP_results %>%
  filter(scaled_pack_years_p < p_value)

```


```{r}

sig_smoking %>%
  mutate(direction = ifelse(scaled_pack_years_beta < 0, "neg", "pos")) %>%
  group_by(decrease_bad, direction) %>%
  tally()

```
Out of 167 IDPs significantly associated with alcohol at the 1% level, 164 (98%) are in the direction of reduced brain health. 3 are in a direction which is consistent with improved health.




